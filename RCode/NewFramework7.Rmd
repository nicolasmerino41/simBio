---
title: "NewFramework7 (General Model)"
author: "Nicolàs Merino"
date: "2025-04-06"
output:
  pdf_document:
    toc: true
    toc_depth: 5
  html_document:
    theme: flatly
    toc: true
    toc_depth: 5
    number_sections: true
    toc_float:
      collapsed: false
    highlight: tango
  word_document:
    toc: false
    toc_depth: '5'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# A Generalized Framework for Trophic Dynamics

We present a generalized formulation of a model describing the dynamics of ecological communities composed of herbivores and predators. Unlike our earlier mean‐field (MF) approach where interaction strengths were fixed (typically set to 1.0) and separated into distinct matrices (for omnivory, herbivore–herbivore consumption, and predator–predator interactions), here we merge all trophic interactions into a single matrix. This merged matrix captures all positive and negative effects among species, and it allows for non‐MF scenarios. In addition, we include a separate competition matrix that affects only the herbivore compartment.

## Trophic Interactions

Let \(X\) be the vector of biomasses for all species in the community, where the first \(S\) entries correspond to the herbivore compartment (including both pure herbivores and omnivores) and the remaining \(R\) entries correspond to predators.

- **Merged Trophic Interaction Matrix (\(A\))**  
  \(A\) is an \((S+R) \times (S+R)\) matrix. Each entry \(a_{ij}\) represents the per‐unit effect that species \(j\) has on species \(i\) via trophic interactions.  
  - Positive entries indicate beneficial effects (e.g. energy gains through predation or omnivory), and negative entries indicate detrimental effects (e.g. losses from being preyed upon).  
  - This matrix is general enough to allow “non‐classical” interactions (for example, if a herbivore feeds on a predator, the corresponding \(a_{ij}\) would reflect that, with its sign determined by the biological context).

- **Competition Matrix (\(C\))**  
  \(C\) is an \(S \times S\) matrix that only affects the herbivore compartment. The entries \(c_{ij}\) (typically nonnegative) capture the intensity of competition between herbivores (and omnivores).  

## Model Equations

### Herbivore (and Omnivore) Dynamics

For each herbivore (or omnivore) species \(i\) (with \(1 \leq i \leq S\)), the per‐capita growth rate is given by

\[
\frac{\dot{H}_i}{H_i} = r_i \left(1 - \frac{(1-\mu)H_i + \mu\,H^{tot} + \sum_{j=1}^{S+R} a_{ij} X_j + \sum_{j=1}^{S} c_{ij} H_j}{K_i}\right),
\]

where:

- \(H_i\) is the biomass of species \(i\).
- \(r_i\) is the intrinsic growth rate.
- \(H^{tot} = \sum_{j=1}^{S} H_j\) is the total biomass of the herbivore compartment.
- \(\mu\) is a competition parameter that weighs the balance between self‐regulation and the influence of total biomass.
- \(a_{ij}\) are the entries of the merged trophic interaction matrix, summarizing all trophic influences (both positive and negative) from species \(j\) on species \(i\).
- \(c_{ij}\) are the entries of the competition matrix \(C\), affecting only herbivores.
- \(K_i\) is the carrying capacity for species \(i\) (often defined as \(K_i = \frac{r_i}{d_i}\), with \(d_i\) being the self‐regulation parameter).

### Predator Dynamics

For each predator species \(\alpha\) (with \(S+1 \leq \alpha \leq S+R\)), the dynamics are given by

\[
\frac{\dot{P}_\alpha}{P_\alpha} = m_\alpha \left( \frac{\sum_{j=1}^{S+R} a_{\alpha j} X_j - P_\alpha}{K_\alpha} - 1 \right),
\]

where:

- \(P_\alpha\) is the biomass of predator \(\alpha\).
- \(m_\alpha\) is the intrinsic mortality rate.
- The term \(\sum_{j=1}^{S+R} a_{\alpha j} X_j\) represents the net trophic gain from all interactions.
- \(K_\alpha\) is the predator carrying capacity, typically \(K_\alpha = \frac{m_\alpha}{d_\alpha}\) (with \(d_\alpha\) the predator self‐regulation parameter).

## Equilibrium Conditions and Viability

At equilibrium (\(\dot{H}_i = 0\) and \(\dot{P}_\alpha = 0\)), the biomasses satisfy:

- **Herbivores:**
  \[
  K_i = (1-\mu)H_i + \mu\,H^{tot} + \sum_{j=1}^{S+R} a_{ij} X_j + \sum_{j=1}^{S} c_{ij} H_j.
  \]

- **Predators:**
  \[
  K_\alpha = \sum_{j=1}^{S+R} a_{\alpha j} X_j - P_\alpha.
  \]

For predator viability, we require that the net trophic gain exceeds losses:

\[
\sum_{j=1}^{S+R} a_{\alpha j} X_j > P_\alpha.
\]

## Perturbation and Sensitivity

To assess stability, we linearize the system around the equilibrium:

\[
\delta \dot{X} = J\,\delta X,
\]

where \(J\) is the Jacobian matrix evaluated at equilibrium. From \(J\) we derive:

- **Resilience:** The maximum real part of \(J\)’s eigenvalues.
- **Reactivity:** Computed from the symmetric part of \(J\).
- **Persistence:** The fraction of species remaining above a threshold after a perturbation.

Additionally, elasticity analysis (e.g., \(E_{x,p} = \frac{\partial \ln x^*}{\partial \ln p}\)) quantifies the sensitivity of equilibrium biomasses to parameter changes.

## Ecosystem Functioning Contributions

Species contributions to an ecosystem function \(\phi\) (e.g., total biomass) are assessed via:

1. **Direct and Indirect Contributions:**
   \[
   \Delta \phi_i = \phi_i + \phi_{/i}\,\bar{a}_i N_i,
   \]
   where \(\phi_i\) is the direct contribution and \(\bar{a}_i N_i\) scales the network‐mediated (indirect) effects.

2. **Removal Impact:**
   \[
   \Delta \phi_i = \phi - \phi_{/i},
   \]
   which can be normalized for comparison:
   \[
   \frac{\Delta \phi_i}{\phi} = \frac{\frac{\phi_i}{\phi} + \bar{a}_i N_i}{1 + \bar{a}_i N_i}.
   \]

## Summary

In this generalized framework, we merge all trophic interactions into a single matrix \(A\) (of size \((S+R) \times (S+R)\)) while keeping a separate competition matrix \(C\) (of size \(S \times S\)) to account for intra-guild competition among herbivores. This formulation allows us to:
- Explore deviations from the mean‐field scenario by randomizing interaction strengths around a given mean.
- Allow for unconventional interactions (e.g., herbivores consuming predators) if they are present in \(A\).
- Analyze stability (resilience, reactivity, persistence) and species sensitivity (elasticities) under a more general set of conditions.
- Ultimately, compare theoretical predictions (from abstract, synthetic communities) with patterns observed in real communities.

This framework provides the foundation for our simulation pipelines and subsequent analyses linking community structure to ecosystem functioning.

---

This chapter sets the stage for the simulation and analysis steps in the subsequent sections. It establishes the model equations, equilibrium conditions, stability metrics, and the basis for comparing theoretical (abstract) predictions with empirical (real) community data.
